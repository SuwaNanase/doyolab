<!doctype html>
<html lang="jp">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>諏訪七星の研究ノート</title>
    
    <link rel="stylesheet" href="main.css">
</head>


<body>
    <!--ホームに帰るためのボタン-->
    <logotohome>
    <a href="index.html"><img src="images/IMG_9011.png" alt=""></a>
    </logotohome>

    <!--h1は見出し１（大見出し）-->
    <h1>raspberrypi4 放置プレイな猫のプログラム </h1><br><br>
    
     <img src = "images/IMG_8254.png"widge="607"height="409"><br>
    <br><br><br>
    
    <h3>
       

    今回は<br><br>
    <font color="#FF3399">ずっとほっとかれたら鳴く</font><br><br>
    というプログラムを実験的に書いてみた。<br><br>
        
    しかし、<br><br>
    なんだろう。<br><br><br><br>
    <font color="#FF3399">まあとにかくうざい！！</font><br><br>
    というのが正直な感想だ。<br><br><br><br><br><br>
        
    今回は
    <font color="#FF3399">happiness_val＜ 0.5</font><br>
    と定義したのだが<br><br>
        
    まあ人間<br><br>
    ほとんどの表情が0.5以下であるため<br><br>
    結局ほとんど鳴いていることになる<br><br><br><br>
    
    こうなってくると<br><br>
    
    <font color="#FF3399">ウザさが圧倒的に勝つため<br><br>
    そもそもこのロボットの存在意義がわからなくなってきた</font>。<br><br> <br><br>
        
    
    自分は<font color="#FF3399">”どういったものが作りたかったのか</font><br><br>
    はたまた<br><br>
    <font color="#FF3399">このロボットで何がしたかったのか</font><br><br>
    を今一度再確認する必要がありそうだ。<br><br><br><br><br><br>
    
        
    ✳︎プログラム <br><br>
     import cognitive_face as CF
import json
import picamera
import time
import cv2 as cv
import pygame
import time
import RPi.GPIO as GPIO
import time, sys
import pygame
import time
 
#ポート番号の指定
RED = 17
GREEN = 27
BLUE = 22
 
#GPIOポートの初期化
GPIO.setmode(GPIO.BCM)
ports = [RED, GREEN, BLUE]
for port in ports:
    GPIO.setup(port, GPIO.OUT)
KEY = ''
ENDPOIN = ''
CF.Key.set(KEY)
CF.BaseUrl.set(ENDPOINT)
while True:
    with picamera.PiCamera() as camera:
        camera.resolution = (512,384)
        camera.capture('test.jpg')
        print('capture')
        img = cv.imread('test.jpg')
        grayimg = cv.cvtColor(img,cv.COLOR_BGR2GRAY)
        img = "test.jpg"
        faces = CF.face.detect(img, attributes='emotion')
        f=json.dumps(faces)
        j=json.loads(f)
        for i in range(0,len(j)):
            print(j[i]['faceAttributes']['emotion']['happiness'])
            happiness_val = j[i]['faceAttributes']['emotion']['happiness']
            
            
            
            if happiness_val < 0.5 :
                
                GPIO.output(RED,0)
                GPIO.output(GREEN,1)
                GPIO.output(BLUE, 0)
                print("幸せ")
                
                
                pygame.mixer.init(frequency=44100)
                pygame.mixer.music.load("/home/pi/mypython/camera/audio/cat1a.mp3")
                pygame.mixer.music.play(1)
                time.sleep(5)
                pygame.mixer.music.stop()
                
                
                GPIO.output(RED,0)
                GPIO.output(GREEN,0)
                GPIO.output(BLUE, 0)
                   
      
 
